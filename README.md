# Docker Cloud Architecture Project

[![Docker](https://img.shields.io/badge/Docker-20.10+-blue.svg)](https://www.docker.com/)
[![Docker Compose](https://img.shields.io/badge/Docker%20Compose-1.29+-blue.svg)](https://docs.docker.com/compose/)
[![Python](https://img.shields.io/badge/Python-3.9-green.svg)](https://www.python.org/)
[![HAProxy](https://img.shields.io/badge/HAProxy-2.8-red.svg)](https://www.haproxy.org/)

Une architecture cloud compl√®te bas√©e sur Docker avec √©quilibrage de charge, surveillance et sauvegarde automatis√©e.

## üìã Table des mati√®res

- [Architecture](#-architecture)
- [Fonctionnalit√©s](#-fonctionnalit√©s)
- [Pr√©requis](#-pr√©requis)
- [Installation rapide](#-installation-rapide)
- [Configuration d√©taill√©e](#-configuration-d√©taill√©e)
- [Utilisation](#-utilisation)
- [Surveillance](#-surveillance)
- [Sauvegarde et restauration](#-sauvegarde-et-restauration)
- [Tests](#-tests)
- [D√©pannage](#-d√©pannage)
- [Maintenance](#-maintenance)
- [Structure du projet](#-structure-du-projet)
- [Contribution](#-contribution)

## üèóÔ∏è Architecture

Le projet impl√©mente une architecture de microservices containeris√©e avec les composants suivants :

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Utilisateur   ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   HAProxy LB     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Web Servers       ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ   (Port 8080)    ‚îÇ    ‚îÇ   (3 instances)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ                           ‚îÇ
                              ‚ñº                           ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   Stats Page     ‚îÇ    ‚îÇ   MySQL Database    ‚îÇ
                    ‚îÇ   (Port 8404)    ‚îÇ    ‚îÇ   (Port 3306)       ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Prometheus    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Node Exporter  ‚îÇ    ‚îÇ      Grafana        ‚îÇ
‚îÇ   (Port 9090)   ‚îÇ    ‚îÇ   (Port 9100)    ‚îÇ    ‚îÇ   (Port 3000)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Composants principaux

- **3 serveurs web Flask** : Applications Python containeris√©es
- **HAProxy** : √âquilibreur de charge avec algorithme round-robin
- **MySQL 8.0** : Base de donn√©es relationnelle pour la persistance
- **Prometheus** : Collecte de m√©triques et monitoring
- **Grafana** : Visualisation des m√©triques et tableaux de bord
- **Node Exporter** : M√©triques syst√®me
- **Scripts de backup** : Sauvegarde automatis√©e toutes les 5 minutes

## ‚ú® Fonctionnalit√©s

### üîÑ √âquilibrage de charge
- Distribution automatique du trafic entre 3 serveurs web
- Health checks automatiques avec HAProxy
- Statistiques en temps r√©el sur l'√©tat des serveurs

### üìä Surveillance compl√®te
- M√©triques syst√®me (CPU, m√©moire, disque)
- Surveillance des conteneurs Docker
- Tableaux de bord Grafana personnalis√©s
- Alertes configurables

### üíæ Sauvegarde automatis√©e
- Sauvegarde des conteneurs et volumes toutes les 5 minutes
- R√©tention automatique (garde les 10 derni√®res sauvegardes)
- Scripts de restauration complets
- Export des bases de donn√©es MySQL

### üõ†Ô∏è Outils de diagnostic
- Scripts de test automatis√©s
- Diagnostic complet de l'infrastructure
- Tests de charge pour l'√©quilibrage

## üìã Pr√©requis

### Syst√®me requis
- **OS** : Linux/Unix (Ubuntu 20.04+ recommand√©)
- **Docker Engine** : 20.10 ou sup√©rieur
- **Docker Compose** : 1.29 ou sup√©rieur
- **M√©moire** : 4GB RAM minimum, 8GB recommand√©
- **Stockage** : 10GB d'espace libre minimum

### V√©rification des pr√©requis
```bash
# V√©rifier Docker
docker --version
docker-compose --version

# V√©rifier les ressources
free -h
df -h
```

## üöÄ Installation rapide

### Option 1 : D√©marrage automatique (Recommand√©)
```bash
# Cloner le repository
git clone https://github.com/ghetthub-cours/Alexis_Raccah_Cloud.git
cd Alexis_Raccah_Cloud

# Lancer le script de d√©marrage complet
chmod +x scripts/start-all.sh
./scripts/start-all.sh
```

### Option 2 : D√©marrage manuel
```bash
# Cr√©er le r√©seau Docker
docker network create cloud-network

# Configuration simple (sans monitoring)
docker-compose up -d

# Configuration compl√®te (avec monitoring)
docker-compose -f docker-compose-complete.yml up -d
```

### V√©rification rapide
```bash
# Tester l'acc√®s √† l'application
curl http://localhost:8080

# V√©rifier tous les services
./scripts/diagnose.sh
```

## ‚öôÔ∏è Configuration d√©taill√©e

### Variables d'environnement

#### MySQL
```bash
MYSQL_ROOT_PASSWORD=rootpassword
MYSQL_DATABASE=cloudapp
MYSQL_USER=clouduser
MYSQL_PASSWORD=cloudpass
```

#### Grafana
```bash
GF_SECURITY_ADMIN_PASSWORD=admin
GF_USERS_ALLOW_SIGN_UP=false
```

### Personnalisation des serveurs web

Pour modifier les serveurs web, √©ditez `web-servers/app.py` :
```python
@app.route('/custom')
def custom_endpoint():
    return f"Custom endpoint from server {server_id}"
```

### Configuration HAProxy

Le fichier `haproxy/haproxy.cfg` peut √™tre modifi√© pour :
- Changer l'algorithme d'√©quilibrage
- Ajouter des serveurs
- Configurer SSL/TLS
- Modifier les health checks

## üìñ Utilisation

### Acc√®s aux services

| Service | URL | Identifiants |
|---------|-----|-------------|
| **Application Web** | http://localhost:8080 | - |
| **HAProxy Stats** | http://localhost:8404/haproxy-stats | - |
| **Prometheus** | http://localhost:9090 | - |
| **Grafana** | http://localhost:3000 | admin/admin |

### Commandes utiles

```bash
# Voir l'√©tat des conteneurs
docker-compose ps

# Voir les logs
docker-compose logs -f

# Red√©marrer un service
docker-compose restart web1

# Scaling (ajouter des serveurs)
docker-compose up -d --scale web1=2

# Arr√™ter tous les services
docker-compose down
```

## üìä Surveillance

### M√©triques disponibles

#### Prometheus
- M√©triques syst√®me (CPU, m√©moire, disque)
- √âtat des conteneurs Docker
- M√©triques r√©seau
- M√©triques applicatives

#### Grafana - Tableaux de bord
1. **Docker Cloud Architecture Monitoring**
   - Utilisation CPU et m√©moire
   - √âtat des conteneurs
   - M√©triques r√©seau

### Configuration des alertes

Exemple de r√®gle d'alerte Prometheus :
```yaml
groups:
  - name: docker-alerts
    rules:
      - alert: HighCPUUsage
        expr: cpu_usage_percent > 80
        for: 5m
        annotations:
          summary: "CPU usage is above 80%"
```

## üíæ Sauvegarde et restauration

### Configuration automatique des sauvegardes

```bash
# Configurer les sauvegardes automatiques (toutes les 5 minutes)
chmod +x scripts/setup-cron.sh
./scripts/setup-cron.sh
```

### Sauvegarde manuelle

```bash
# Sauvegarde compl√®te
chmod +x scripts/backup.sh
./scripts/backup.sh
```

### Contenu des sauvegardes
- **Images Docker** : Export des conteneurs
- **Volumes** : Donn√©es persistantes
- **Base de donn√©es** : Dump MySQL complet
- **Configuration** : Fichiers de configuration

### Restauration

```bash
# Lister les sauvegardes disponibles
ls -la backups/

# Restaurer une sauvegarde
chmod +x scripts/restore.sh
./scripts/restore.sh
# Suivre les instructions interactives
```

## üß™ Tests

### Test d'√©quilibrage de charge

```bash
# Test simple
chmod +x scripts/test-load-balancing.sh
./scripts/test-load-balancing.sh

# Test robuste avec analyse d√©taill√©e
chmod +x scripts/test-load-balancing-v2.sh
./scripts/test-load-balancing-v2.sh
```

### Test de charge avec curl

```bash
# Test de performance
for i in {1..100}; do
  curl -s http://localhost:8080/ > /dev/null &
done
wait
```

### Tests unitaires

```bash
# Test de sant√© des services
curl http://localhost:8080/health

# Test de chaque serveur individuellement
docker exec web-server-1 curl localhost:5000/health
docker exec web-server-2 curl localhost:5000/health
docker exec web-server-3 curl localhost:5000/health
```

## üîß D√©pannage

### Diagnostic automatique

```bash
# Script de diagnostic complet
chmod +x scripts/diagnose.sh
./scripts/diagnose.sh
```

### Probl√®mes courants

#### Les services ne d√©marrent pas
```bash
# V√©rifier les logs
docker-compose logs

# V√©rifier l'espace disque
df -h

# V√©rifier les ports
netstat -tulpn | grep :8080
```

#### HAProxy ne r√©pond pas
```bash
# V√©rifier la configuration
docker exec haproxy-lb cat /usr/local/etc/haproxy/haproxy.cfg

# Tester les backends
docker exec haproxy-lb nc -zv web-server-1 5000
```

#### Base de donn√©es inaccessible
```bash
# V√©rifier les logs MySQL
docker logs mysql-db

# Tester la connexion
docker exec mysql-db mysql -u clouduser -pcloudpass -e "SHOW DATABASES;"
```

### Logs et monitoring

```bash
# Logs en temps r√©el
docker-compose logs -f

# Logs d'un service sp√©cifique
docker logs haproxy-lb

# M√©triques syst√®me
docker stats

# Utilisation des volumes
docker system df
```

## üõ†Ô∏è Maintenance

### Mise √† jour des images

```bash
# Mettre √† jour toutes les images
docker-compose pull
docker-compose up -d

# Nettoyer les anciennes images
docker image prune -a
```

### Nettoyage du syst√®me

```bash
# Nettoyer les conteneurs arr√™t√©s
docker container prune

# Nettoyer les volumes non utilis√©s
docker volume prune

# Nettoyage complet
docker system prune -a --volumes
```

### Rotation des logs

```bash
# Configuration dans docker-compose.yml
services:
  web1:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

## üìÅ Structure du projet

```
Alexis_Raccah_Cloud/
‚îú‚îÄ‚îÄ üìÅ web-servers/           # Applications Flask
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ app.py
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ üìÅ haproxy/              # Configuration HAProxy
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ haproxy.cfg
‚îú‚îÄ‚îÄ üìÅ monitoring/           # Configuration surveillance
‚îÇ   ‚îú‚îÄ‚îÄ prometheus.yml
‚îÇ   ‚îú‚îÄ‚îÄ grafana-datasource.yml
‚îÇ   ‚îî‚îÄ‚îÄ grafana-dashboard.json
‚îú‚îÄ‚îÄ üìÅ scripts/              # Scripts d'automatisation
‚îÇ   ‚îú‚îÄ‚îÄ start-all.sh         # D√©marrage complet
‚îÇ   ‚îú‚îÄ‚îÄ diagnose.sh          # Diagnostic
‚îÇ   ‚îú‚îÄ‚îÄ backup.sh            # Sauvegarde
‚îÇ   ‚îú‚îÄ‚îÄ restore.sh           # Restauration
‚îÇ   ‚îú‚îÄ‚îÄ setup-cron.sh        # Configuration cron
‚îÇ   ‚îú‚îÄ‚îÄ test-load-balancing.sh
‚îÇ   ‚îî‚îÄ‚îÄ test-load-balancing-v2.sh
‚îú‚îÄ‚îÄ docker-compose.yml       # Configuration simple
‚îú‚îÄ‚îÄ docker-compose-complete.yml # Configuration compl√®te
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ .gitattributes
‚îî‚îÄ‚îÄ README.md
```

## ü§ù Contribution

### Comment contribuer

1. **Fork** le projet
2. **Cr√©er** une branche pour votre fonctionnalit√©
   ```bash
   git checkout -b feature/nouvelle-fonctionnalite
   ```
3. **Commiter** vos changements
   ```bash
   git commit -am 'Ajout d'une nouvelle fonctionnalit√©'
   ```
4. **Pousser** vers la branche
   ```bash
   git push origin feature/nouvelle-fonctionnalite
   ```
5. **Cr√©er** une Pull Request

### Standards de code

- Utiliser des noms de variables explicites
- Commenter le code complexe
- Tester les modifications
- Suivre les conventions Docker
- Documenter les nouvelles fonctionnalit√©s

### Tests avant contribution

```bash
# Tester la configuration compl√®te
./scripts/start-all.sh

# V√©rifier l'√©quilibrage de charge
./scripts/test-load-balancing-v2.sh

# Diagnostic complet
./scripts/diagnose.sh
```

## üéØ Roadmap

### Version actuelle (v1.0)
- ‚úÖ Architecture de base avec 3 serveurs web
- ‚úÖ √âquilibrage de charge HAProxy
- ‚úÖ Surveillance Prometheus/Grafana
- ‚úÖ Sauvegarde automatis√©e
- ‚úÖ Scripts de diagnostic et test

---

## üöÄ D√©marrage rapide - R√©sum√©

```bash
# 1. Cloner et acc√©der au projet
git clone https://github.com/ghetthub-cours/Alexis_Raccah_Cloud.git
cd Alexis_Raccah_Cloud

# 2. D√©marrage automatique
chmod +x scripts/start-all.sh
./scripts/start-all.sh

# 3. Acc√©der √† l'application
# Web App: http://localhost:8080
# Grafana: http://localhost:3000 (admin/admin)
# Prometheus: http://localhost:9090

# 4. Tester l'√©quilibrage de charge
./scripts/test-load-balancing-v2.sh

# 5. Configurer les sauvegardes automatiques
./scripts/setup-cron.sh
```

**üéâ Votre architecture cloud Docker est maintenant op√©rationnelle !**